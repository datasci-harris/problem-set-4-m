<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Pset 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Pset 4 (P1_P2)_files/libs/clipboard/clipboard.min.js"></script>
<script src="Pset 4 (P1_P2)_files/libs/quarto-html/quarto.js"></script>
<script src="Pset 4 (P1_P2)_files/libs/quarto-html/popper.min.js"></script>
<script src="Pset 4 (P1_P2)_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Pset 4 (P1_P2)_files/libs/quarto-html/anchor.min.js"></script>
<link href="Pset 4 (P1_P2)_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Pset 4 (P1_P2)_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Pset 4 (P1_P2)_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Pset 4 (P1_P2)_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Pset 4 (P1_P2)_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pset 4</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Partner 1: Mahnoor Partner 2: Mauricio Paniagua</p>
<p>Import packages</p>
<div id="5c4ae2db" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Download and explore the Provider of Services (POS) file (Partner 1)</p>
<div id="98e1f201" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the 2016 dataset</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'/mnt/data/pos2016.csv'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>pos2016 <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">pos2016.csv"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the dataset</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>pos2016.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRVDR_CTGRY_SBTYP_CD</th>
<th data-quarto-table-cell-role="th">PRVDR_CTGRY_CD</th>
<th data-quarto-table-cell-role="th">FAC_NAME</th>
<th data-quarto-table-cell-role="th">PRVDR_NUM</th>
<th data-quarto-table-cell-role="th">STATE_CD</th>
<th data-quarto-table-cell-role="th">PGM_TRMNTN_CD</th>
<th data-quarto-table-cell-role="th">ZIP_CD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>1</td>
<td>SOUTHEAST ALABAMA MEDICAL CENTER</td>
<td>010001</td>
<td>AL</td>
<td>0</td>
<td>36301.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>1</td>
<td>NORTH JACKSON HOSPITAL</td>
<td>010004</td>
<td>AL</td>
<td>1</td>
<td>35740.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>1</td>
<td>MARSHALL MEDICAL CENTER SOUTH</td>
<td>010005</td>
<td>AL</td>
<td>0</td>
<td>35957.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>1</td>
<td>ELIZA COFFEE MEMORIAL HOSPITAL</td>
<td>010006</td>
<td>AL</td>
<td>0</td>
<td>35631.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.0</td>
<td>1</td>
<td>MIZELL MEMORIAL HOSPITAL</td>
<td>010007</td>
<td>AL</td>
<td>0</td>
<td>36467.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>#####Q1 #The variables pulled are PRVDR_CTGRY_SBTYP_CD: ROVIDER Category (Short Term) PRVDR_CTGRY_CD: PROVIDER Category (Long Term) FAC_NAME: Facility Name PRVDR_NUM: unique CMS certification number STATE_CD: State Abbreviation PGM_TRMNTN_CD: the current termination status for the provider ZIP_CD: ZIP CODE</p>
<div id="989c7e71" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Q2 (a)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset data for short-term hospitals</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>short_term_hospitals_2016 <span class="op">=</span> pos2016[(pos2016[<span class="st">'PRVDR_CTGRY_CD'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (pos2016[<span class="st">'PRVDR_CTGRY_SBTYP_CD'</span>] <span class="op">==</span> <span class="dv">1</span>)]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of hospitals</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>num_hospitals_2016 <span class="op">=</span> short_term_hospitals_2016[<span class="st">'PRVDR_NUM'</span>].nunique()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of short-term hospitals in 2016: </span><span class="sc">{</span>num_hospitals_2016<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Number of short-term hospitals in 2016: 7245</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Yes, there are 7245 hospitals categorised as short term facilities</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">##Q2 (b) According to NHS, short term hospitals </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># in 2016 were 3,436 in number. This is a fairly</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  low number compared to</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#CMS data. This discrepancy could be due to </span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># categorisation of what constitutes a short term hospital </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># and if they were eligble for medicaid/medicare.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of short-term hospitals in 2016: 7245</code></pre>
</div>
</div>
<div id="1584489a" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q3</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the file paths</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>file_paths <span class="op">=</span> [</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">pos2017.csv"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">pos2018.csv"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">pos2019.csv"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>data_frames <span class="op">=</span> []</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through file paths and process each year's data</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, file_path <span class="kw">in</span> <span class="bu">zip</span>([<span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>], file_paths):</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use 'ISO-8859-1' encoding to avoid UnicodeDecodeError</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(file_path, encoding<span class="op">=</span><span class="st">'ISO-8859-1'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for short-term hospitals</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    short_term_df <span class="op">=</span> df[(df[<span class="st">'PRVDR_CTGRY_CD'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (df[<span class="st">'PRVDR_CTGRY_SBTYP_CD'</span>] <span class="op">==</span> <span class="dv">1</span>)].copy()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign the 'Year' column</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    short_term_df[<span class="st">'Year'</span>] <span class="op">=</span> year</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    data_frames.append(short_term_df)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all years into a single DataFrame</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>combined_data <span class="op">=</span> pd.concat([short_term_hospitals_2016] <span class="op">+</span> data_frames, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NaN values in 'Year' column with 2016</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>combined_data[<span class="st">'Year'</span>].fillna(<span class="dv">2016</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>combined_data[<span class="st">'Year'</span>] <span class="op">=</span> combined_data[<span class="st">'Year'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows to confirm</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>combined_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_10288\1110801356.py:27: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing 'df[col].method(value, inplace=True)', try using 'df.method({col: value}, inplace=True)' or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  combined_data['Year'].fillna(2016, inplace=True)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRVDR_CTGRY_SBTYP_CD</th>
<th data-quarto-table-cell-role="th">PRVDR_CTGRY_CD</th>
<th data-quarto-table-cell-role="th">FAC_NAME</th>
<th data-quarto-table-cell-role="th">PRVDR_NUM</th>
<th data-quarto-table-cell-role="th">STATE_CD</th>
<th data-quarto-table-cell-role="th">PGM_TRMNTN_CD</th>
<th data-quarto-table-cell-role="th">ZIP_CD</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>1</td>
<td>SOUTHEAST ALABAMA MEDICAL CENTER</td>
<td>010001</td>
<td>AL</td>
<td>0</td>
<td>36301.0</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>1</td>
<td>NORTH JACKSON HOSPITAL</td>
<td>010004</td>
<td>AL</td>
<td>1</td>
<td>35740.0</td>
<td>2016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>1</td>
<td>MARSHALL MEDICAL CENTER SOUTH</td>
<td>010005</td>
<td>AL</td>
<td>0</td>
<td>35957.0</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>1</td>
<td>ELIZA COFFEE MEMORIAL HOSPITAL</td>
<td>010006</td>
<td>AL</td>
<td>0</td>
<td>35631.0</td>
<td>2016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.0</td>
<td>1</td>
<td>MIZELL MEMORIAL HOSPITAL</td>
<td>010007</td>
<td>AL</td>
<td>0</td>
<td>36467.0</td>
<td>2016</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="da2c8d58" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q3</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>combined_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRVDR_CTGRY_SBTYP_CD</th>
<th data-quarto-table-cell-role="th">PRVDR_CTGRY_CD</th>
<th data-quarto-table-cell-role="th">FAC_NAME</th>
<th data-quarto-table-cell-role="th">PRVDR_NUM</th>
<th data-quarto-table-cell-role="th">STATE_CD</th>
<th data-quarto-table-cell-role="th">PGM_TRMNTN_CD</th>
<th data-quarto-table-cell-role="th">ZIP_CD</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>1</td>
<td>SOUTHEAST ALABAMA MEDICAL CENTER</td>
<td>010001</td>
<td>AL</td>
<td>0</td>
<td>36301.0</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>1</td>
<td>NORTH JACKSON HOSPITAL</td>
<td>010004</td>
<td>AL</td>
<td>1</td>
<td>35740.0</td>
<td>2016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>1</td>
<td>MARSHALL MEDICAL CENTER SOUTH</td>
<td>010005</td>
<td>AL</td>
<td>0</td>
<td>35957.0</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>1</td>
<td>ELIZA COFFEE MEMORIAL HOSPITAL</td>
<td>010006</td>
<td>AL</td>
<td>0</td>
<td>35631.0</td>
<td>2016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.0</td>
<td>1</td>
<td>MIZELL MEMORIAL HOSPITAL</td>
<td>010007</td>
<td>AL</td>
<td>0</td>
<td>36467.0</td>
<td>2016</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="c1815e1f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q3</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to a CSV file for external viewing</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>combined_data.to_csv(<span class="st">'combined_data_full.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="09b47fb3" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of observations per year</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>observations_by_year <span class="op">=</span> combined_data.groupby(<span class="st">'Year'</span>).size().reset_index(name<span class="op">=</span><span class="st">'Observations'</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar chart</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>observations_plot <span class="op">=</span> alt.Chart(observations_by_year).mark_bar().encode(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Year:O'</span>, title<span class="op">=</span><span class="st">'Year'</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Observations:Q'</span>, title<span class="op">=</span><span class="st">'Number of Observations'</span>, scale<span class="op">=</span>alt.Scale(domain<span class="op">=</span>[<span class="dv">0</span>, observations_by_year[<span class="st">'Observations'</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">10</span>])),  <span class="co"># Adjust the y-axis scale as needed</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>alt.Color(<span class="st">'Year:O'</span>, legend<span class="op">=</span>alt.Legend(title<span class="op">=</span><span class="st">"Year"</span>))  <span class="co"># Color encoding by Year</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Observations by Year'</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create text labels for each bar with reduced font size</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>text_labels <span class="op">=</span> observations_plot.mark_text(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    align<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    baseline<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    dy<span class="op">=-</span><span class="dv">5</span>,  <span class="co"># Adjust the vertical position of the text</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    fontSize<span class="op">=</span><span class="dv">8</span>  <span class="co"># Set the desired font size for the text</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Year:O'</span>, title<span class="op">=</span><span class="st">'Year'</span>),  <span class="co"># Ensure the x encoding matches the bars</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Observations:Q'</span>, title<span class="op">=</span><span class="st">'Number of Observations'</span>),  <span class="co"># Ensure the y encoding matches the bars</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'Observations:Q'</span>  <span class="co"># Display the Observations value</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the bar chart and text labels</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>final_plot <span class="op">=</span> observations_plot <span class="op">+</span> text_labels</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>final_plot.display()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-69ad417591a243719c4faa9719211d3c.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-69ad417591a243719c4faa9719211d3c.vega-embed details,
  #altair-viz-69ad417591a243719c4faa9719211d3c.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-69ad417591a243719c4faa9719211d3c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-69ad417591a243719c4faa9719211d3c") {
      outputDiv = document.getElementById("altair-viz-69ad417591a243719c4faa9719211d3c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "bar"}, "encoding": {"color": {"field": "Year", "legend": {"title": "Year"}, "type": "ordinal"}, "x": {"field": "Year", "title": "Year", "type": "ordinal"}, "y": {"field": "Observations", "scale": {"domain": [0, 7313.0]}, "title": "Number of Observations", "type": "quantitative"}}, "title": "Number of Observations by Year"}, {"mark": {"type": "text", "align": "center", "baseline": "bottom", "dy": -5, "fontSize": 8}, "encoding": {"color": {"field": "Year", "legend": {"title": "Year"}, "type": "ordinal"}, "text": {"field": "Observations", "type": "quantitative"}, "x": {"field": "Year", "title": "Year", "type": "ordinal"}, "y": {"field": "Observations", "title": "Number of Observations", "type": "quantitative"}}, "title": "Number of Observations by Year"}], "data": {"name": "data-6e088fb646a81f88b05aa2910776946a"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-6e088fb646a81f88b05aa2910776946a": [{"Year": 2016, "Observations": 7245}, {"Year": 2017, "Observations": 7260}, {"Year": 2018, "Observations": 7277}, {"Year": 2019, "Observations": 7303}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="0541d2d2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q4</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count unique hospitals per year</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>unique_hospitals_by_year <span class="op">=</span> combined_data.groupby(<span class="st">'Year'</span>)[<span class="st">'PRVDR_NUM'</span>].nunique().reset_index(name<span class="op">=</span><span class="st">'Unique_Hospitals'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar chart for unique hospitals</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>unique_hospitals_plot <span class="op">=</span> alt.Chart(unique_hospitals_by_year).mark_bar().encode(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Year:O'</span>, title<span class="op">=</span><span class="st">'Year'</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Unique_Hospitals:Q'</span>, title<span class="op">=</span><span class="st">'Number of Unique Hospitals'</span>, scale<span class="op">=</span>alt.Scale(domain<span class="op">=</span>[<span class="dv">0</span>, unique_hospitals_by_year[<span class="st">'Unique_Hospitals'</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">10</span>])),  <span class="co"># Adjust the y-axis scale as needed</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>alt.Color(<span class="st">'Year:O'</span>, legend<span class="op">=</span>alt.Legend(title<span class="op">=</span><span class="st">"Year"</span>))  <span class="co"># Color encoding by Year</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Number of Unique Hospitals by Year'</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create text labels for each bar with reduced font size</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>unique_hospital_text_labels <span class="op">=</span> unique_hospitals_plot.mark_text(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    align<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    baseline<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    dy<span class="op">=-</span><span class="dv">5</span>,  <span class="co"># Adjust the vertical position of the text</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    fontSize<span class="op">=</span><span class="dv">7</span>  <span class="co"># Set the desired font size for the text</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Year:O'</span>, title<span class="op">=</span><span class="st">'Year'</span>),  <span class="co"># Ensure the x encoding matches the bars</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Unique_Hospitals:Q'</span>, title<span class="op">=</span><span class="st">'Number of Unique Hospitals'</span>),  <span class="co"># Ensure the y encoding matches the bars</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span><span class="st">'Unique_Hospitals:Q'</span>  <span class="co"># Display the Unique Hospitals value</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the bar chart and text labels</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>unique_hospitals_final_plot <span class="op">=</span> unique_hospitals_plot <span class="op">+</span> unique_hospital_text_labels</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>unique_hospitals_final_plot.display()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
  #altair-viz-e623c13b6b4e4b08bafc747d4cfd3265.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-e623c13b6b4e4b08bafc747d4cfd3265.vega-embed details,
  #altair-viz-e623c13b6b4e4b08bafc747d4cfd3265.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-e623c13b6b4e4b08bafc747d4cfd3265"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e623c13b6b4e4b08bafc747d4cfd3265") {
      outputDiv = document.getElementById("altair-viz-e623c13b6b4e4b08bafc747d4cfd3265");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "layer": [{"mark": {"type": "bar"}, "encoding": {"color": {"field": "Year", "legend": {"title": "Year"}, "type": "ordinal"}, "x": {"field": "Year", "title": "Year", "type": "ordinal"}, "y": {"field": "Unique_Hospitals", "scale": {"domain": [0, 7313.0]}, "title": "Number of Unique Hospitals", "type": "quantitative"}}, "title": "Number of Unique Hospitals by Year"}, {"mark": {"type": "text", "align": "center", "baseline": "bottom", "dy": -5, "fontSize": 7}, "encoding": {"color": {"field": "Year", "legend": {"title": "Year"}, "type": "ordinal"}, "text": {"field": "Unique_Hospitals", "type": "quantitative"}, "x": {"field": "Year", "title": "Year", "type": "ordinal"}, "y": {"field": "Unique_Hospitals", "title": "Number of Unique Hospitals", "type": "quantitative"}}, "title": "Number of Unique Hospitals by Year"}], "data": {"name": "data-fb031e55e99ba8ec3fcbbce283c39849"}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-fb031e55e99ba8ec3fcbbce283c39849": [{"Year": 2016, "Unique_Hospitals": 7245}, {"Year": 2017, "Unique_Hospitals": 7260}, {"Year": 2018, "Unique_Hospitals": 7277}, {"Year": 2019, "Unique_Hospitals": 7303}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<p>##Q4 Since both the number of observations and the number of unique hospitals plot show similar trends, it indicates that the dataset is relatively stable, with few hospitals entering or exiting the dataset each year. This consistency suggests that while some hospitals may close or change ownership, the overall number of operational short-term hospitals remains steady.</p>
<p>Part 2: Identify hospital closures in POS file (Partner 2) Q1</p>
<div id="f5702f5d" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define paths</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>file_path_2016 <span class="op">=</span> <span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\pos2016.csv"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>file_path_2017 <span class="op">=</span> <span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\pos2017.csv"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>file_path_2018 <span class="op">=</span> <span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\pos2018.csv"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>file_path_2019 <span class="op">=</span> <span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\pos2019.csv"</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in provided paths</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>df_2016 <span class="op">=</span> pd.read_csv(file_path_2016, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>df_2017<span class="op">=</span> pd.read_csv(file_path_2017, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>df_2018<span class="op">=</span> pd.read_csv(file_path_2018, encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>df_2019<span class="op">=</span> pd.read_csv(file_path_2019,  encoding<span class="op">=</span><span class="st">"ISO-8859-1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3678bf3e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter active hospitals in 2016</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>active_hospitals <span class="op">=</span> df_2016[df_2016[<span class="st">'PGM_TRMNTN_CD'</span>] <span class="op">==</span> <span class="dv">0</span>][[<span class="st">'FAC_NAME'</span>, <span class="st">'ZIP_CD'</span>]].copy()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>active_hospitals[<span class="st">'Suspected Closure Year'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to check active status in a given year</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_hospitals_status(df, year, active_hospitals):</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter active providers for the year</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    active_in_year <span class="op">=</span> <span class="bu">set</span>(df[df[<span class="st">'PGM_TRMNTN_CD'</span>] <span class="op">==</span> <span class="dv">0</span>][<span class="st">'FAC_NAME'</span>])</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for hospitals missing or inactive in the year</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> active_hospitals.iterrows():</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        facility_name <span class="op">=</span> row[<span class="st">'FAC_NAME'</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Mark the year of suspected closure if the hospital is no longer active</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> facility_name <span class="kw">not</span> <span class="kw">in</span> active_in_year <span class="kw">and</span> pd.isna(active_hospitals.at[index, <span class="st">'Suspected Closure Year'</span>]):</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            active_hospitals.at[index, <span class="st">'Suspected Closure Year'</span>] <span class="op">=</span> year</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function across the years 2017 to 2019</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>check_hospitals_status(df_2017, <span class="dv">2017</span>, active_hospitals)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>check_hospitals_status(df_2018, <span class="dv">2018</span>, active_hospitals)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>check_hospitals_status(df_2019, <span class="dv">2019</span>, active_hospitals)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter hospitals suspected of closure</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>closed_hospitals <span class="op">=</span> active_hospitals.dropna(subset<span class="op">=</span>[<span class="st">'Suspected Closure Year'</span>])</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of suspected closed hospitals: </span><span class="sc">{</span><span class="bu">len</span>(closed_hospitals)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(closed_hospitals[[<span class="st">'FAC_NAME'</span>, <span class="st">'ZIP_CD'</span>, <span class="st">'Suspected Closure Year'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of suspected closed hospitals: 12139
                                  FAC_NAME   ZIP_CD Suspected Closure Year
2            MARSHALL MEDICAL CENTER SOUTH  35957.0                   2019
3           ELIZA COFFEE MEMORIAL HOSPITAL  35631.0                   2019
13                   CALLAHAN EYE HOSPITAL  35233.0                   2018
17                 CHEROKEE MEDICAL CENTER  35960.0                   2018
26                        WEDOWEE HOSPITAL  36278.0                   2017
...                                    ...      ...                    ...
141511         AMERICAN CAREQUEST EAST BAY  94597.0                   2017
141515               STERLING HOSPICE CARE  95993.0                   2019
141540           HAMPTON HOSPICE CARE, INC  92503.0                   2019
141545             ICHC - FERNDALE PIONEER  98248.0                   2019
141551  HEALTHPOINT VALLEY CITIES ENUMCLAW  98022.0                   2019

[12139 rows x 3 columns]</code></pre>
</div>
</div>
<p>Question 2</p>
<div id="ef416f3f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by hospital name and select the first 10 rows</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sorted_closed_hospitals <span class="op">=</span> closed_hospitals.sort_values(by<span class="op">=</span><span class="st">'FAC_NAME'</span>).head(<span class="dv">10</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the hospital names and suspected closure year</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_closed_hospitals[[<span class="st">'FAC_NAME'</span>, <span class="st">'Suspected Closure Year'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               FAC_NAME Suspected Closure Year
109675            (CLOSED) REFLECTIONS TREATMENT AGENCY                   2019
115695                     1ST CARE HOME HEALTH EL PASO                   2017
138262               1ST CHOICE HEALTHCARE SERVICES INC                   2019
95227                        1ST CHOICE HOME HEALTHCARE                   2018
35111                   1ST FAMILY HOME HEALTHCARE, INC                   2018
133800                   1ST GOVERNMENT HEALTHCARE, INC                   2017
24224                          1ST HOME HEALTH CARE INC                   2018
41342   1ST OPTION ADULT DAY SERVICES &amp; HOME HEALTH LLC                   2018
81329                           21 READE PLACE ASC, LLC                   2018
95098                   21ST CENTURY HOME HEALTH AGENCY                   2017</code></pre>
</div>
</div>
<p>Question 3</p>
<div id="15335dbc" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Identify potential mergers/acquisitions</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to check if the count of active hospitals in a zip code decreased the year after closure</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_mergers(closed_hospitals, df_by_year):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    potential_mergers <span class="op">=</span> []</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Iterate over each suspected closed hospital</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> closed_hospitals.iterrows():</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        zip_code <span class="op">=</span> row[<span class="st">'ZIP_CD'</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        closure_year <span class="op">=</span> <span class="bu">int</span>(row[<span class="st">'Suspected Closure Year'</span>])</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if we have data for the following year</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        next_year_df <span class="op">=</span> df_by_year.get(closure_year <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> next_year_df <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Count active hospitals in this zip code in the suspected closure year and the year after</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            active_in_year <span class="op">=</span> df_by_year[closure_year][(df_by_year[closure_year][<span class="st">'ZIP_CD'</span>] <span class="op">==</span> zip_code) <span class="op">&amp;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                                                      (df_by_year[closure_year][<span class="st">'PGM_TRMNTN_CD'</span>] <span class="op">==</span> <span class="st">'0'</span>)]</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            active_next_year <span class="op">=</span> next_year_df[(next_year_df[<span class="st">'ZIP_CD'</span>] <span class="op">==</span> zip_code) <span class="op">&amp;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                                            (next_year_df[<span class="st">'PGM_TRMNTN_CD'</span>] <span class="op">==</span> <span class="st">'0'</span>)]</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the count of active hospitals did not decrease, it may be a merger/acquisition</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(active_in_year) <span class="op">&lt;=</span> <span class="bu">len</span>(active_next_year):</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                potential_mergers.append(index)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out potential mergers from suspected closures</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    corrected_closed_hospitals <span class="op">=</span> closed_hospitals.drop(index<span class="op">=</span>potential_mergers)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corrected_closed_hospitals, closed_hospitals.loc[potential_mergers]</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary with data for each year for easier lookup</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>df_by_year <span class="op">=</span> {<span class="dv">2016</span>: df_2016, <span class="dv">2017</span>: df_2017, <span class="dv">2018</span>: df_2018, <span class="dv">2019</span>: df_2019}</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Apply the filter to identify potential mergers and obtain the corrected list of closures</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>corrected_closed_hospitals, potential_mergers <span class="op">=</span> filter_mergers(closed_hospitals, df_by_year)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Reporting</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of hospitals potentially involved in mergers/acquisitions: </span><span class="sc">{</span><span class="bu">len</span>(potential_mergers)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of corrected suspected closures after filtering: </span><span class="sc">{</span><span class="bu">len</span>(corrected_closed_hospitals)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Sort and display the corrected list of closures by name, showing the first 10 rows</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>sorted_corrected_closed_hospitals <span class="op">=</span> corrected_closed_hospitals.sort_values(by<span class="op">=</span><span class="st">'FAC_NAME'</span>).head(<span class="dv">10</span>)</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sorted_corrected_closed_hospitals[[<span class="st">'FAC_NAME'</span>, <span class="st">'ZIP_CD'</span>, <span class="st">'Suspected Closure Year'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of hospitals potentially involved in mergers/acquisitions: 8499
Number of corrected suspected closures after filtering: 3640
                                     FAC_NAME   ZIP_CD Suspected Closure Year
109675  (CLOSED) REFLECTIONS TREATMENT AGENCY  37912.0                   2019
138262     1ST CHOICE HEALTHCARE SERVICES INC  77063.0                   2019
61582                    247 HOME HEALTH CARE  48180.0                   2019
35813          25 EAST SAME DAY SURGERY CENTE  60602.0                   2019
35030                    3 ANGELS HOME HEALTH  60077.0                   2019
79274               35TH STREET HEALTH CENTER  10018.0                   2019
11444        446 SCHOLL HOME HEALTH CARE, INC  91411.0                   2019
90046               A 1 ASSOCIATED NURSES INC  44905.0                   2019
57076               A B HOME HEALTH CARE, LLC   2119.0                   2019
10166                 A C  HOME HEALTH AGENCY  90230.0                   2019</code></pre>
</div>
</div>
<p>Download Census zip code shapefile (Partner 1)</p>
<p>.shp – The main shapefile that stores the geometry of the spatial features (e.g., points, lines, polygons). .shx – The shape index format file that stores index data for quickly accessing the geometry in the .shp file. The file size is 514218 KB. .dbf – A database file that stores attribute data associated with the shapes in a tabular format (like a spreadsheet). It contains fields for each shape’s attributes (e.g., name, type, ID). The file size is 429 KB. .prj – The projection file that defines the coordinate system and projection information for the shapefile. The file size is 1 KB. .xml – An XML file that can store metadata about the shapefile, including data source, purpose, date created, and additional information for reference. The file size is 5 KB.</p>
<p>##The .shp (shape file) is the heaviest among all the files: 514,218 KB.</p>
<p>##The .prj (projection file) is the lightest: 1 KB</p>
<div id="0b9a6032" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ef68c27a" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>zip_shapefile <span class="op">=</span> gpd.read_file(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">gz_2010_us_860_00_500k.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="66202eb6" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Load the shapefile and rename ZCTA5 to ZIP_CD</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>zip_shapefile <span class="op">=</span> gpd.read_file(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">gz_2010_us_860_00_500k.shp"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>zip_shapefile <span class="op">=</span> zip_shapefile.rename(columns<span class="op">=</span>{<span class="st">'ZCTA5'</span>: <span class="st">'ZIP_CD'</span>})</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure ZIP_CD is a string for consistency</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>zip_shapefile[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> zip_shapefile[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Filter for Texas ZIP Codes (prefixes 733, 75, 76, 77, 78)</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile <span class="op">=</span> zip_shapefile[zip_shapefile[<span class="st">'ZIP_CD'</span>].<span class="bu">str</span>.startswith((<span class="st">'733'</span>, <span class="st">'75'</span>, <span class="st">'76'</span>, <span class="st">'77'</span>, <span class="st">'78'</span>, <span class="st">'79'</span>))]</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Load the cleaned POS dataset and ensure ZIP_CD is string and clean up any decimal formatting</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>combined_data_full <span class="op">=</span> pd.read_csv(<span class="st">"C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">arifm</span><span class="ch">\\</span><span class="st">OneDrive</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">problem-set-4-m</span><span class="ch">\\</span><span class="st">combined_data_full.csv"</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>combined_data_full[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> combined_data_full[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.split(<span class="st">'.'</span>).<span class="bu">str</span>[<span class="dv">0</span>].<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the POS data for Texas ZIP codes</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>texas_hospitals <span class="op">=</span> combined_data_full[combined_data_full[<span class="st">'ZIP_CD'</span>].<span class="bu">str</span>.startswith((<span class="st">'733'</span>, <span class="st">'75'</span>, <span class="st">'76'</span>, <span class="st">'77'</span>, <span class="st">'78'</span>, <span class="st">'79'</span>))]</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Count hospitals per ZIP Code in Texas</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>hospitals_per_zip <span class="op">=</span> texas_hospitals.groupby(<span class="st">'ZIP_CD'</span>).size().reset_index(name<span class="op">=</span><span class="st">'hospital_count'</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Merge the hospital counts with the Texas ZIP Code shapefile</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile <span class="op">=</span> texas_zip_shapefile.merge(hospitals_per_zip, on<span class="op">=</span><span class="st">'ZIP_CD'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Display the result for verification</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(texas_zip_shapefile[[<span class="st">'ZIP_CD'</span>, <span class="st">'hospital_count'</span>]].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ZIP_CD  hospital_count
0  78624             4.0
1  78626             4.0
2  78628             0.0
3  78631             0.0
4  78632             0.0</code></pre>
</div>
</div>
<div id="6580bf4c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q2</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a choropleth of the number of hospitals per ZIP code in Texas</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile.plot(column<span class="op">=</span><span class="st">'hospital_count'</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                         cmap<span class="op">=</span><span class="st">'Reds'</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                         linewidth<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                         ax<span class="op">=</span>ax, </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                         edgecolor<span class="op">=</span><span class="st">'0.8'</span>, </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                         legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Number of Hospitals per ZIP Code in Texas (2016)"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Pset%204%20(P1_P2)_files/figure-html/cell-17-output-1.png" width="868" height="766" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Calculate zip code’s distance to the nearest hospital (Partner 2)</p>
<div id="5aa7b835" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the shapefile</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>zip_shapefile <span class="op">=</span> gpd.read_file(<span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\gz_2010_us_860_00_500k.shp"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>zip_shapefile <span class="op">=</span> zip_shapefile.rename(columns<span class="op">=</span>{<span class="st">'ZCTA5'</span>: <span class="st">'ZIP_CD'</span>})</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure ZIP_CD is a string for consistency</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>zip_shapefile[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> zip_shapefile[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Filter for Texas ZIP Codes (prefixes 75, 76, 77, 78)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile <span class="op">=</span> zip_shapefile[zip_shapefile[<span class="st">'ZIP_CD'</span>].<span class="bu">str</span>.startswith((<span class="st">'75'</span>, <span class="st">'76'</span>, <span class="st">'77'</span>, <span class="st">'78'</span>))]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Load the cleaned POS dataset and ensure ZIP_CD is string and clean up any decimal formatting</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>combined_data_full <span class="op">=</span> pd.read_csv(<span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\combined_data_full.csv"</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>combined_data_full[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> combined_data_full[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.split(<span class="st">'.'</span>).<span class="bu">str</span>[<span class="dv">0</span>].<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the POS data for Texas ZIP codes</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>texas_hospitals <span class="op">=</span> combined_data_full[combined_data_full[<span class="st">'ZIP_CD'</span>].<span class="bu">str</span>.startswith((<span class="st">'75'</span>, <span class="st">'76'</span>, <span class="st">'77'</span>, <span class="st">'78'</span>))]</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Count hospitals per ZIP Code in Texas</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>hospitals_per_zip <span class="op">=</span> texas_hospitals.groupby(<span class="st">'ZIP_CD'</span>).size().reset_index(name<span class="op">=</span><span class="st">'hospital_count'</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Merge the hospital counts with the Texas ZIP Code shapefile</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile <span class="op">=</span> texas_zip_shapefile.merge(hospitals_per_zip, on<span class="op">=</span><span class="st">'ZIP_CD'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna({<span class="st">'hospital_count'</span>: <span class="dv">0</span>})</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Display the result for verification</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(texas_zip_shapefile[[<span class="st">'ZIP_CD'</span>, <span class="st">'hospital_count'</span>]].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ZIP_CD  hospital_count
0  78624             4.0
1  78626             4.0
2  78628             0.0
3  78631             0.0
4  78632             0.0</code></pre>
</div>
</div>
<p>Part D, Question 1</p>
<div id="d5f0d888" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If `zip_shapefile` contains polygons, you can calculate centroids like this:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>zips_data <span class="op">=</span> zip_shapefile.copy()  <span class="co"># Or use an appropriate subset of zip_shapefile</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>zips_data[<span class="st">'centroid'</span>] <span class="op">=</span> zips_data.geometry.centroid</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>zips_data[<span class="st">'longitude'</span>] <span class="op">=</span> zips_data[<span class="st">'centroid'</span>].x</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>zips_data[<span class="st">'latitude'</span>] <span class="op">=</span> zips_data[<span class="st">'centroid'</span>].y</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a GeoDataFrame for ZIP code centroids using longitude and latitude columns</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>zips_all_centroids <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    zips_data, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    geometry<span class="op">=</span>gpd.points_from_xy(zips_data.longitude, zips_data.latitude),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dimensions of zips_all_centroids: </span><span class="sc">{</span>zips_all_centroids<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zips_all_centroids.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_10288\1678993922.py:3: UserWarning: Geometry is in a geographic CRS. Results from 'centroid' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  zips_data['centroid'] = zips_data.geometry.centroid</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensions of zips_all_centroids: (33120, 9)
           GEO_ID ZIP_CD   NAME   LSAD  CENSUSAREA  \
0  8600000US01040  01040  01040  ZCTA5      21.281   
1  8600000US01050  01050  01050  ZCTA5      38.329   
2  8600000US01053  01053  01053  ZCTA5       5.131   
3  8600000US01056  01056  01056  ZCTA5      27.205   
4  8600000US01057  01057  01057  ZCTA5      44.907   

                     geometry                    centroid  longitude  \
0  POINT (-72.64107 42.21257)  POINT (-72.64107 42.21257) -72.641072   
1  POINT (-72.86985 42.28786)  POINT (-72.86985 42.28786) -72.869849   
2  POINT (-72.71162 42.35349)  POINT (-72.71162 42.35349) -72.711615   
3  POINT (-72.45805 42.19215)  POINT (-72.45805 42.19215) -72.458045   
4   POINT (-72.3243 42.09165)   POINT (-72.3243 42.09165) -72.324299   

    latitude  
0  42.212567  
1  42.287863  
2  42.353487  
3  42.192155  
4  42.091649  </code></pre>
</div>
</div>
<p>Part D, Question 2:</p>
<div id="1a565046" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Texas ZIP codes</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>zips_texas_centroids <span class="op">=</span> zips_all_centroids[zips_all_centroids[<span class="st">'ZIP_CD'</span>].<span class="bu">str</span>.startswith((<span class="st">'75'</span>, <span class="st">'76'</span>, <span class="st">'77'</span>, <span class="st">'78'</span>))]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Texas and bordering states ZIP codes</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>bordering_prefixes <span class="op">=</span> (<span class="st">'75'</span>, <span class="st">'76'</span>, <span class="st">'77'</span>, <span class="st">'78'</span>, <span class="st">'87'</span>, <span class="st">'88'</span>, <span class="st">'73'</span>, <span class="st">'74'</span>, <span class="st">'71'</span>, <span class="st">'72'</span>, <span class="st">'70'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>zips_texas_borderstates_centroids <span class="op">=</span> zips_all_centroids[zips_all_centroids[<span class="st">'ZIP_CD'</span>].<span class="bu">str</span>.startswith(bordering_prefixes)]</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Count unique ZIP codes in Texas and Texas + bordering states</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>num_texas_zipcodes <span class="op">=</span> zips_texas_centroids[<span class="st">'ZIP_CD'</span>].nunique()</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>num_borderstates_zipcodes <span class="op">=</span> zips_texas_borderstates_centroids[<span class="st">'ZIP_CD'</span>].nunique()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of unique Texas ZIP codes: </span><span class="sc">{</span>num_texas_zipcodes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of unique Texas and bordering states ZIP codes: </span><span class="sc">{</span>num_borderstates_zipcodes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the function to check if two polygons intersect</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_polygons_intersect(polygon1, polygon2):</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> polygon1.intersects(polygon2)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all Texas ZIP code geometries into a single polygon</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>texas_polygon <span class="op">=</span> zips_texas_centroids.geometry.union_all()</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all bordering states ZIP code geometries into a single polygon</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>bordering_state_polygon <span class="op">=</span> zips_texas_borderstates_centroids.geometry.union_all()</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if Texas polygon intersects the bordering states polygon</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>is_bordering <span class="op">=</span> check_polygons_intersect(texas_polygon, bordering_state_polygon)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Does Texas border the combined polygon of bordering states?"</span>, is_bordering)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of unique Texas ZIP codes: 1614
Number of unique Texas and bordering states ZIP codes: 3736
Does Texas border the combined polygon of bordering states? True</code></pre>
</div>
</div>
<p>Part D, Question 3</p>
<div id="9ff3c43b" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create hospital_count by counting hospitals per ZIP code in 2016</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming combined_data_full has a 'ZIP_CD' column and only contains records for 2016</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>hospitals_per_zip_2016 <span class="op">=</span> combined_data_full.groupby(<span class="st">'ZIP_CD'</span>).size().reset_index(name<span class="op">=</span><span class="st">'hospital_count'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ZIP codes with at least one hospital</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>hospitals_2016 <span class="op">=</span> hospitals_per_zip_2016[hospitals_per_zip_2016[<span class="st">'hospital_count'</span>] <span class="op">&gt;</span> <span class="dv">0</span>][[<span class="st">'ZIP_CD'</span>]]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge zips_texas_borderstates_centroids with hospitals_2016 on ZIP_CD</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>zips_withhospital_centroids <span class="op">=</span> zips_texas_borderstates_centroids.merge(</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    hospitals_2016,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'ZIP_CD'</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'inner'</span>  <span class="co"># Inner join to keep only ZIP codes with hospitals in 2016</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result and check number of ZIP codes with hospitals</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zips_withhospital_centroids.head())</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of ZIP codes with at least one hospital in 2016: </span><span class="sc">{</span><span class="bu">len</span>(zips_withhospital_centroids)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           GEO_ID ZIP_CD   NAME   LSAD  CENSUSAREA  \
0  8600000US70043  70043  70043  ZCTA5       7.775   
1  8600000US70068  70068  70068  ZCTA5      53.812   
2  8600000US70119  70119  70119  ZCTA5       4.472   
3  8600000US70127  70127  70127  ZCTA5       7.095   
4  8600000US70301  70301  70301  ZCTA5     288.050   

                     geometry                    centroid  longitude  \
0  POINT (-89.96276 29.94804)  POINT (-89.96276 29.94804) -89.962764   
1  POINT (-90.43469 30.13426)  POINT (-90.43469 30.13426) -90.434695   
2  POINT (-90.08702 29.97574)  POINT (-90.08702 29.97574) -90.087020   
3  POINT (-89.97675 30.02501)  POINT (-89.97675 30.02501) -89.976755   
4   POINT (-90.74089 29.8141)   POINT (-90.74089 29.8141) -90.740889   

    latitude  
0  29.948041  
1  30.134262  
2  29.975742  
3  30.025014  
4  29.814099  
Number of ZIP codes with at least one hospital in 2016: 803</code></pre>
</div>
</div>
<p>Part D, Question 4</p>
<div id="00275247" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming zips_texas_centroids and zips_withhospital_centroids are already defined</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step A: Subset to 10 ZIP codes</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>zips_texas_subset <span class="op">=</span> zips_texas_centroids.head(<span class="dv">10</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure time for the subset calculation</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject both GeoDataFrames to a projected CRS</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>zips_texas_subset <span class="op">=</span> zips_texas_subset.to_crs(epsg<span class="op">=</span><span class="dv">32614</span>)  <span class="co"># UTM zone for Texas (adjust EPSG if needed)</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>zips_withhospital_centroids <span class="op">=</span> zips_withhospital_centroids.to_crs(epsg<span class="op">=</span><span class="dv">32614</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance to nearest hospital for the subset</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>zips_texas_subset[<span class="st">'nearest_hospital_distance'</span>] <span class="op">=</span> zips_texas_subset.geometry.<span class="bu">apply</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: zips_withhospital_centroids.distance(x).<span class="bu">min</span>()</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>time_taken_subset <span class="op">=</span> end_time <span class="op">-</span> start_time</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time taken for subset calculation: </span><span class="sc">{</span>time_taken_subset<span class="sc">:.4f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate for full calculation (this is a rough estimate, adjust based on experience)</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>estimated_full_time <span class="op">=</span> time_taken_subset <span class="op">*</span> (<span class="bu">len</span>(zips_texas_centroids) <span class="op">/</span> <span class="bu">len</span>(zips_texas_subset))</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated time for full calculation: </span><span class="sc">{</span>estimated_full_time<span class="sc">:.4f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Step B: Full calculation</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>start_time_full <span class="op">=</span> time.time()</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject the full GeoDataFrames</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>zips_texas_centroids <span class="op">=</span> zips_texas_centroids.to_crs(epsg<span class="op">=</span><span class="dv">32614</span>)  <span class="co"># UTM zone for Texas (adjust EPSG if needed)</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance to nearest hospital for all Texas ZIP codes</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>zips_texas_centroids[<span class="st">'nearest_hospital_distance'</span>] <span class="op">=</span> zips_texas_centroids.geometry.<span class="bu">apply</span>(</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: zips_withhospital_centroids.distance(x).<span class="bu">min</span>()</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>end_time_full <span class="op">=</span> time.time()</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>time_taken_full <span class="op">=</span> end_time_full <span class="op">-</span> start_time_full</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time taken for full calculation: </span><span class="sc">{</span>time_taken_full<span class="sc">:.4f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated vs Actual: </span><span class="sc">{</span>estimated_full_time<span class="sc">:.4f}</span><span class="ss"> vs </span><span class="sc">{</span>time_taken_full<span class="sc">:.4f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Step C: Check the .prj file</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the shapefile for Texas ZIP codes is available</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>prj_file_path <span class="op">=</span> <span class="vs">r"C:\Users\arifm\OneDrive\Documents\GitHub\problem-set-4-m\gz_2010_us_860_00_500k.prj"</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(prj_file_path, <span class="st">'r'</span>) <span class="im">as</span> prj_file:</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    crs_info <span class="op">=</span> prj_file.read()</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS Information:"</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(crs_info)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co"># The unit is typically indicated in the .prj file; you might see "meters" for most UTM projections.</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co"># If it’s in meters, convert distances</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Conversion factor: 1 meter = 0.000621371 miles</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="co"># If the CRS is in meters, convert distances</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">"meters"</span> <span class="kw">in</span> crs_info.lower():</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>    zips_texas_centroids[<span class="st">'nearest_hospital_distance_miles'</span>] <span class="op">=</span> zips_texas_centroids[<span class="st">'nearest_hospital_distance'</span>] <span class="op">*</span> <span class="fl">0.000621371</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(zips_texas_centroids[[<span class="st">'ZIP_CD'</span>, <span class="st">'nearest_hospital_distance_miles'</span>]].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time taken for subset calculation: 0.0532 seconds
Estimated time for full calculation: 8.5821 seconds
Time taken for full calculation: 1.7403 seconds
Estimated vs Actual: 8.5821 vs 1.7403 seconds
CRS Information:
GEOGCS["GCS_North_American_1983",DATUM["D_North_American_1983",SPHEROID["GRS_1980",6378137,298.257222101]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]</code></pre>
</div>
</div>
<p>Part D, Question 5</p>
<div id="be0b1a2d" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Calculate the distance to the nearest hospital for each ZIP code in Texas</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First, ensure that zips_texas_centroids and zips_withhospital_centroids are defined</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column for distance to nearest hospital</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>zips_texas_centroids[<span class="st">'nearest_hospital_distance'</span>] <span class="op">=</span> zips_texas_centroids.geometry.<span class="bu">apply</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: zips_withhospital_centroids.distance(x).<span class="bu">min</span>()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate average distance to the nearest hospital for each ZIP code</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>average_distances <span class="op">=</span> zips_texas_centroids[[<span class="st">'ZIP_CD'</span>, <span class="st">'nearest_hospital_distance'</span>]].copy()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by ZIP code and calculate the average distance</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>avg_distance_by_zip <span class="op">=</span> average_distances.groupby(<span class="st">'ZIP_CD'</span>)[<span class="st">'nearest_hospital_distance'</span>].mean().reset_index()</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Convert from meters to miles</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the distance is in meters</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>avg_distance_by_zip[<span class="st">'avg_distance_to_hospital_miles'</span>] <span class="op">=</span> avg_distance_by_zip[<span class="st">'nearest_hospital_distance'</span>] <span class="op">/</span> <span class="fl">1609.34</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Report the average distance in miles</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Average distance to nearest hospital in miles:"</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(avg_distance_by_zip[[<span class="st">'ZIP_CD'</span>, <span class="st">'avg_distance_to_hospital_miles'</span>]])</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Merge with original GeoDataFrame for mapping</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>zips_map <span class="op">=</span> zips_texas_centroids.merge(avg_distance_by_zip, on<span class="op">=</span><span class="st">'ZIP_CD'</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Map the values</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>zips_map.boundary.plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>zips_map.plot(column<span class="op">=</span><span class="st">'avg_distance_to_hospital_miles'</span>, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>               legend_kwds<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">"Average Distance to Nearest Hospital (Miles)"</span>, <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>},</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>               cmap<span class="op">=</span><span class="st">'OrRd'</span>, missing_kwds<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'lightgrey'</span>})</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Distance to Nearest Hospital by ZIP Code in Texas'</span>)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average distance to nearest hospital in miles:
     ZIP_CD  avg_distance_to_hospital_miles
0     75001                        0.000000
1     75002                        5.277592
2     75006                        0.000000
3     75007                        2.044397
4     75009                        9.536071
...     ...                             ...
1609  78956                       12.170958
1610  78957                        0.000000
1611  78959                       17.633501
1612  78962                        0.000000
1613  78963                        8.337668

[1614 rows x 2 columns]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_10288\2060361457.py:28: UserWarning: The GeoSeries you are attempting to plot is composed of empty geometries. Nothing has been displayed.
  zips_map.boundary.plot(ax=ax, linewidth=1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Pset%204%20(P1_P2)_files/figure-html/cell-23-output-3.png" width="916" height="767" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>#Effects of closures on access in Texas (Partner 1)</p>
<div id="385364c6" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q1</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load CSV files with specified encoding to handle special characters</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>pos2016 <span class="op">=</span> pd.read_csv(<span class="st">'pos2016.csv'</span>, encoding<span class="op">=</span><span class="st">'ISO-8859-1'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>pos2017 <span class="op">=</span> pd.read_csv(<span class="st">'pos2017.csv'</span>, encoding<span class="op">=</span><span class="st">'ISO-8859-1'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>pos2018 <span class="op">=</span> pd.read_csv(<span class="st">'pos2018.csv'</span>, encoding<span class="op">=</span><span class="st">'ISO-8859-1'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>pos2019 <span class="op">=</span> pd.read_csv(<span class="st">'pos2019.csv'</span>, encoding<span class="op">=</span><span class="st">'ISO-8859-1'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for active Texas hospitals in 2016</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>active_hospitals <span class="op">=</span> pos2016[(pos2016[<span class="st">'STATE_CD'</span>] <span class="op">==</span> <span class="st">'TX'</span>) <span class="op">&amp;</span> (pos2016[<span class="st">'PGM_TRMNTN_CD'</span>] <span class="op">==</span> <span class="dv">0</span>)][[<span class="st">'FAC_NAME'</span>, <span class="st">'ZIP_CD'</span>]].copy()</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>active_hospitals[<span class="st">'Suspected Closure Year'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to check active status in a given year for Texas hospitals</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_hospitals_status(df, year, active_hospitals):</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter active providers for the year in Texas</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    active_in_year <span class="op">=</span> <span class="bu">set</span>(df[(df[<span class="st">'STATE_CD'</span>] <span class="op">==</span> <span class="st">'TX'</span>) <span class="op">&amp;</span> (df[<span class="st">'PGM_TRMNTN_CD'</span>] <span class="op">==</span> <span class="dv">0</span>)][<span class="st">'FAC_NAME'</span>])</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check for hospitals missing or inactive in the year</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> active_hospitals.iterrows():</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>        facility_name <span class="op">=</span> row[<span class="st">'FAC_NAME'</span>]</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Mark the year of suspected closure if the hospital is no longer active</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> facility_name <span class="kw">not</span> <span class="kw">in</span> active_in_year <span class="kw">and</span> pd.isna(row[<span class="st">'Suspected Closure Year'</span>]):</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>            active_hospitals.at[index, <span class="st">'Suspected Closure Year'</span>] <span class="op">=</span> year</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function across the years 2017 to 2019</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>check_hospitals_status(pos2017, <span class="dv">2017</span>, active_hospitals)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>check_hospitals_status(pos2018, <span class="dv">2018</span>, active_hospitals)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>check_hospitals_status(pos2019, <span class="dv">2019</span>, active_hospitals)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter hospitals suspected of closure</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>closed_hospitals <span class="op">=</span> active_hospitals.dropna(subset<span class="op">=</span>[<span class="st">'Suspected Closure Year'</span>])</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by ZIP code to get the count of closures in each ZIP code</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>closures_by_zipcode <span class="op">=</span> closed_hospitals.groupby(<span class="st">'ZIP_CD'</span>).size().reset_index(name<span class="op">=</span><span class="st">'Number of Closures'</span>)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"List of ZIP codes in Texas with hospital closures from 2016-2019:"</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(closures_by_zipcode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of ZIP codes in Texas with hospital closures from 2016-2019:
      ZIP_CD  Number of Closures
0    75001.0                   2
1    75006.0                   2
2    75007.0                   2
3    75010.0                   3
4    75019.0                   1
..       ...                 ...
564  79924.0                   2
565  79925.0                   3
566  79934.0                   1
567  79936.0                   2
568  79938.0                   1

[569 rows x 2 columns]</code></pre>
</div>
</div>
<div id="d8de54d8" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q2</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">##Merging the files</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the 'Number of Closures' column in closures_by_zipcode to avoid duplicates</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>closures_by_zipcode <span class="op">=</span> closures_by_zipcode.rename(columns<span class="op">=</span>{<span class="st">'Number of Closures'</span>: <span class="st">'Closures'</span>})</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that both ZIP_CD columns are of type string</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>closures_by_zipcode[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> closures_by_zipcode[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> texas_zip_shapefile[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the decimal point from ZIP_CD in closures_by_zipcode</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>closures_by_zipcode[<span class="st">'ZIP_CD'</span>] <span class="op">=</span> closures_by_zipcode[<span class="st">'ZIP_CD'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.split(<span class="st">'.'</span>).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the types</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"closures_by_zipcode ZIP_CD type:"</span>, closures_by_zipcode[<span class="st">'ZIP_CD'</span>].dtype)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"texas_zip_shapefile ZIP_CD type:"</span>, texas_zip_shapefile[<span class="st">'ZIP_CD'</span>].dtype)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the merge</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> texas_zip_shapefile.merge(closures_by_zipcode, on<span class="op">=</span><span class="st">'ZIP_CD'</span>, how<span class="op">=</span><span class="st">'left'</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the merge was successful by displaying the first few rows</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Merged Data Sample:"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(merged_data.head())</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the columns to ensure no duplicates exist</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Columns in merged DataFrame:"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(merged_data.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>closures_by_zipcode ZIP_CD type: object
texas_zip_shapefile ZIP_CD type: object
Merged Data Sample:
           GEO_ID ZIP_CD   NAME   LSAD  CENSUSAREA  \
0  8600000US78624  78624  78624  ZCTA5     708.041   
1  8600000US78626  78626  78626  ZCTA5      93.046   
2  8600000US78628  78628  78628  ZCTA5      73.382   
3  8600000US78631  78631  78631  ZCTA5     325.074   
4  8600000US78632  78632  78632  ZCTA5      96.278   

                                            geometry  hospital_count  Closures  
0  POLYGON ((-98.96423 30.49848, -98.96416 30.498...             4.0       3.0  
1  POLYGON ((-97.60944 30.57185, -97.61688 30.568...             4.0       1.0  
2  POLYGON ((-97.69285 30.57122, -97.69286 30.571...             0.0       1.0  
3  POLYGON ((-99.13053 30.36555, -99.13065 30.365...             0.0       0.0  
4  POLYGON ((-97.40946 29.75929, -97.40947 29.758...             0.0       0.0  

Columns in merged DataFrame:
Index(['GEO_ID', 'ZIP_CD', 'NAME', 'LSAD', 'CENSUSAREA', 'geometry',
       'hospital_count', 'Closures'],
      dtype='object')</code></pre>
</div>
</div>
<div id="0ddb66a1" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q2</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Plot the choropleth map</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">14</span>))</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the number of closures per ZIP code</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>merged_data.plot(</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'Closures'</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'OrRd'</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,  <span class="co"># Outline for ZIP codes</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span>{</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'label'</span>: <span class="st">"Number of Hospital Closures"</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'orientation'</span>: <span class="st">"horizontal"</span>,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'shrink'</span>: <span class="fl">0.8</span>,  <span class="co"># Shrink legend to better fit below the map</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    missing_kwds<span class="op">=</span>{</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"color"</span>: <span class="st">"lightgrey"</span>,</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"label"</span>: <span class="st">"No data"</span>,</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and labels</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Hospital Closures in Texas by ZIP Code (2016-2019)'</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()  <span class="co"># Hide axis borders and ticks</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Save figure</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"texas_hospital_closures_map.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Pset%204%20(P1_P2)_files/figure-html/cell-26-output-1.png" width="857" height="1008" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="0a7120a7" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q2</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of directly affected zip codes</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for zip codes where the number of closures is greater than 0</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>affected_zip_codes_count <span class="op">=</span> merged_data[merged_data[<span class="st">'Closures'</span>] <span class="op">&gt;</span> <span class="dv">0</span>].shape[<span class="dv">0</span>]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'There are </span><span class="sc">{</span>affected_zip_codes_count<span class="sc">}</span><span class="ss"> directly affected zip codes in Texas.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 506 directly affected zip codes in Texas.</code></pre>
</div>
</div>
<div id="a3aaae15" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q3</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create a GeoDataFrame for directly affected ZIP codes</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>directly_affected_zip_codes <span class="op">=</span> closures_by_zipcode[closures_by_zipcode[<span class="st">'Closures'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>directly_affected_gdf <span class="op">=</span> texas_zip_shapefile[texas_zip_shapefile[<span class="st">'ZIP_CD'</span>].isin(directly_affected_zip_codes[<span class="st">'ZIP_CD'</span>])]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Create a 10-mile buffer around the directly affected ZIP codes</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>directly_affected_gdf <span class="op">=</span> directly_affected_gdf.set_geometry(directly_affected_gdf.geometry)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>buffered_zip_codes <span class="op">=</span> directly_affected_gdf.geometry.<span class="bu">buffer</span>(<span class="dv">10</span> <span class="op">*</span> <span class="fl">1609.34</span>)  <span class="co"># 10 miles in meters</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new GeoDataFrame with the buffered geometries</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>buffered_gdf <span class="op">=</span> gpd.GeoDataFrame(geometry<span class="op">=</span>buffered_zip_codes)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Spatial join with the overall Texas ZIP code shapefile to find all ZIP codes within the buffer</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Use predicate instead of op</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>indirectly_affected_zip_codes <span class="op">=</span> gpd.sjoin(texas_zip_shapefile, buffered_gdf, how<span class="op">=</span><span class="st">'inner'</span>, predicate<span class="op">=</span><span class="st">'intersects'</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Count the number of indirectly affected ZIP codes</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>indirectly_affected_zip_codes_count <span class="op">=</span> indirectly_affected_zip_codes[<span class="st">'ZIP_CD'</span>].nunique()</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of indirectly affected ZIP codes in Texas: </span><span class="sc">{</span>indirectly_affected_zip_codes_count<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_10288\2142131297.py:10: UserWarning: Geometry is in a geographic CRS. Results from 'buffer' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.

  buffered_zip_codes = directly_affected_gdf.geometry.buffer(10 * 1609.34)  # 10 miles in meters</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of indirectly affected ZIP codes in Texas: 1614</code></pre>
</div>
</div>
<div id="01dbb149" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q4</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming indirectly_affected_zip_codes is already defined</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a category column in texas_zip_shapefile for plotting</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile[<span class="st">'Category'</span>] <span class="op">=</span> <span class="st">'Not Affected'</span>  <span class="co"># Default category</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark directly affected ZIP codes</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile.loc[texas_zip_shapefile[<span class="st">'ZIP_CD'</span>].isin(directly_affected_zip_codes[<span class="st">'ZIP_CD'</span>]), <span class="st">'Category'</span>] <span class="op">=</span> <span class="st">'Directly Affected'</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark indirectly affected ZIP codes (those within the buffer) that are not directly affected</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>indirectly_affected_zip_set <span class="op">=</span> <span class="bu">set</span>(indirectly_affected_zip_codes[<span class="st">'ZIP_CD'</span>])</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile.loc[</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    texas_zip_shapefile[<span class="st">'ZIP_CD'</span>].isin(indirectly_affected_zip_set) <span class="op">&amp;</span> </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>texas_zip_shapefile[<span class="st">'ZIP_CD'</span>].isin(directly_affected_zip_codes[<span class="st">'ZIP_CD'</span>]), </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Category'</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>] <span class="op">=</span> <span class="st">'Indirectly Affected'</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Plotting</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ZIP codes with different colors for each category</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Directly Affected'</span>: <span class="st">'lightblue'</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Indirectly Affected'</span>: <span class="st">'darkblue'</span>,</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Not Affected'</span>: <span class="st">'lightgrey'</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>texas_zip_shapefile.plot(column<span class="op">=</span><span class="st">'Category'</span>, </span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>                         color<span class="op">=</span>texas_zip_shapefile[<span class="st">'Category'</span>].<span class="bu">map</span>(color_map),</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>                         edgecolor<span class="op">=</span><span class="st">'black'</span>, </span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>                         ax<span class="op">=</span>ax)</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and legend</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Hospital Closure Impact in Texas by ZIP Code'</span>, fontsize<span class="op">=</span><span class="dv">18</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()  <span class="co"># Hide axis</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co">#  legend</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>handles <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>color_map[key], label<span class="op">=</span>key) <span class="cf">for</span> key <span class="kw">in</span> color_map.keys()]</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>handles, title<span class="op">=</span><span class="st">"Closure Impact"</span>, loc<span class="op">=</span><span class="st">'lower left'</span>)</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Save figure</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"texas_hospital_closures_choropleth.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\arifm\AppData\Local\Temp\ipykernel_10288\1916920632.py:30: UserWarning: Only specify one of 'column' or 'color'. Using 'color'.
  texas_zip_shapefile.plot(column='Category',</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Pset%204%20(P1_P2)_files/figure-html/cell-29-output-2.png" width="662" height="785" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>##Q1 (Partner 1) The first pass method may rely on straightforward queries or analyses, like counting the number of closures recorded in the data or using flagging criteria to identify potentially affected facilities. While it can quickly highlight areas of concern, it is usually limited by potential inaccuracies in the data, lack of context, and failure to consider nuances. Therefore, follow-up verification and validation processes are often necessary to ensure the findings are accurate and comprehensive, as the initial analysis may overlook critical factors influencing the actual situation.</p>
<p>##Question 2 (Partner 2)</p>
<p>Identifying ZIP codes affected by hospital closures provides insight into healthcare access but has significant limitations. Closures can be misleading due to hospital mergers, where services continue under different names, obscuring the true impact on access. Additionally, the variation in ZIP code size and population density means that a closure in a rural area may not affect access as severely as one in a densely populated urban environment. A static analysis that counts open hospitals neglects shifts in healthcare needs and service offerings, while transportation barriers can further limit access for many residents. To improve this measure, a dynamic analysis could track changes over time, integrating transportation data to assess travel times and public transit routes. Including socioeconomic factors and community health assessments would provide a more nuanced understanding of access issues, while considering alternative healthcare options like urgent care and telemedicine could broaden the perspective on healthcare availability. Collaborating with local health organizations can yield valuable insights into the community impacts of closures and enhance our understanding of access disparities.</p>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>